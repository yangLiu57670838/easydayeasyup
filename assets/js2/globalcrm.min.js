/*! globalcrm 25-11-2015 */
app.directive("navbarSearch",["$timeout",function(a){return{restrict:"A",templateUrl:"navbar-search.html",link:function(a,b,c){a.showNavbarSearch=!1,a.toggleSearch=function(){a.showNavbarSearch=!a.showNavbarSearch},a.submitNavbarSearch=function(){a.showNavbarSearch=!1}}}}]),app.directive("menuToggle",["$location",function(a){return{restrict:"A",transclude:!0,replace:!0,scope:{name:"@",icon:"@"},templateUrl:"menu-toggle.html",link:function(b,c,d){icon=d.icon,icon&&c.children().first().prepend('<i class="'+icon+'"></i>&nbsp;'),c.children().first().on("click",function(a){a.preventDefault(),link=angular.element(a.currentTarget),link.hasClass("active")?link.removeClass("active"):link.addClass("active")}),b.isOpen=function(){return folder="/"+a.path().split("/")[1],folder==d.path}}}}]),app.directive("menuLink",function(){return{restrict:"A",transclude:!0,replace:!0,scope:{href:"@",icon:"@",name:"@"},templateUrl:"menu-link.html",controller:["$element","$location","$rootScope",function(a,b,c){this.getName=function(b){return void 0!==b?b:a.find("a").text().trim()},this.setBreadcrumb=function(a){c.pageTitle=this.getName(a)},this.isSelected=function(a){return b.path()==a.slice(1,a.length)}}],link:function(a,b,c,d){icon=c.icon,icon&&b.children().first().prepend('<i class="'+icon+'"></i>&nbsp;'),d.isSelected(c.href)&&d.setBreadcrumb(c.name),b.click(function(){d.setBreadcrumb(c.name)}),a.isSelected=function(){return d.isSelected(c.href)}}}}),app.directive("scrollSpy",["$window",function(a){return{link:function(b,c,d){angular.element(a).bind("scroll",function(){b.scroll=this.pageYOffset,b.$$phase||b.$apply()})}}}]),app.directive("navbarScroll",function(a){return{restrict:"A",link:function(b,c,d){var e=angular.element(".main-container .navbar");angular.element(a).bind("scroll",function(){this.pageYOffset>0?e.addClass("scroll"):e.removeClass("scroll")})}}}),app.directive("nouiSlider",function(){return{restrict:"A",link:function(a,b,c){var d=angular.element(c.bind),e=angular.element(c.bindRange),f=angular.element(c.indicator);d.length&&(start=d.val()),start=c.start?c.start:0,range=c.range?c.range:0,range?(startPoint=[start,range],b.addClass("noUi-range")):startPoint=[start],step=c.step?parseInt(c.step):0,min=c.min?parseInt(c.min):0,max=c.max?parseInt(c.max):10,$(b).noUiSlider({start:startPoint,step:step,range:{min:[min],max:[max]}}),"true"===f.selector&&$(b).on("slide set change",function(a,b){$(this).find(".noUi-handle div").length||$(this).find(".noUi-handle").append("<div>"+b+"</div>"),$(this).find(".noUi-handle div").html(b)}),$(b).on("slide",function(a,b){e.length?(v=parseInt(b[0]),v2=parseInt(b[1])):v=parseInt(b),d.length&&(void 0!==d[0].value?d.val(v):d.html(v)),e.length&&(void 0!==e[0].value?e.val(v2):e.html(v2))})}}}),app.filter("nospace",function(){return function(a){return a?a.replace(/ /g,""):""}}),app.controller("complianceCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function(a,b,c,d,e,f,g,h){function j(){b.get("/searchComplianceName").success(function(b){a.all=b,console.log(a.all)})}function k(){var b=[];for(i=0;i<a.all.length;i++){var c=a.all[i].first_name+" "+a.all[i].last_name;b.push(c)}a.customerss=b}a.all=[],"superadmin"==a.staffRole||"admin"==a.staffRole||"compliance"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),j(),a.showChanged=function(){isNaN(a.selectedCustomer)?k():console.log("......")},a.addCompliance=function(){function c(){b.get("/getCID?customerName2="+a.selectedCustomer).success(function(b){1==b.length?(console.log("cid is:",b[0].cid),console.log("input is:",a.selectedCustomer),a.cid=b[0].cid,d()):(h.startAlert("danger","Error","Please type customer name","md md-error"),g.path("/compliance"))})}function d(){b.post("/addcompliance?introCheckA="+a.introCheckA+"&introCommentsA="+a.introCommentsA+"&introCheckB="+a.introCheckB+"&introCommentsB="+a.introCommentsB+"&qualificationCheckA="+a.qualificationCheckA+"&qualificationCommentsA="+a.qualificationCommentsA+"&qualificationCheckB="+a.qualificationCheckB+"&qualificationCommentsB="+a.qualificationCommentsB+"&qualificationCheckC="+a.qualificationCheckC+"&qualificationCommentsC="+a.qualificationCommentsC+"&qualificationCheckD="+a.qualificationCheckD+"&qualificationCommentsD="+a.qualificationCommentsD+"&qualificationCheckE="+a.qualificationCheckE+"&qualificationCommentsE="+a.qualificationCommentsE+"&backgroundCheckA="+a.backgroundCheckA+"&backgroundCommentsA="+a.backgroundCommentsA+"&selectionCheckA="+a.selectionCheckA+"&selectionCommentsA="+a.selectionCommentsA+"&selectionCheckB="+a.selectionCheckB+"&selectionCommentsB="+a.selectionCommentsB+"&selectionCheckC="+a.selectionCheckC+"&selectionCommentsC="+a.selectionCommentsC+"&selectionCheckD="+a.selectionCheckD+"&selectionCommentsD="+a.selectionCommentsD+"&selectionCheckE="+a.selectionCheckE+"&selectionCommentsE="+a.selectionCommentsE+"&selectionCheckF="+a.selectionCheckF+"&selectionCommentsF="+a.selectionCommentsF+"&selectionCheckG="+a.selectionCheckG+"&selectionCommentsG="+a.selectionCommentsG+"&costCheckA="+a.costCheckA+"&costCommentsA="+a.costCommentsA+"&costCheckB="+a.costCheckB+"&costCommentsB="+a.costCommentsB+"&costCheckC="+a.costCheckC+"&costCommentsC="+a.costCommentsC+"&costCheckD="+a.costCheckD+"&costCommentsD="+a.costCommentsD+"&costCheckE="+a.costCheckE+"&costCommentsE="+a.costCommentsE+"&costCheckF="+a.costCheckF+"&costCommentsF="+a.costCommentsF+"&costCheckG="+a.costCheckG+"&costCommentsG="+a.costCommentsG+"&urgencyCheckA="+a.urgencyCheckA+"&urgencyCommentsA="+a.urgencyCommentsA+"&urgencyCheckB="+a.urgencyCheckB+"&urgencyCommentsB="+a.urgencyCommentsB+"&urgencyCheckC="+a.urgencyCheckC+"&urgencyCommentsC="+a.urgencyCommentsC+"&urgencyCheckD="+a.urgencyCheckD+"&urgencyCommentsD="+a.urgencyCommentsD+"&urgencyCheckE="+a.urgencyCheckE+"&urgencyCommentsE="+a.urgencyCommentsE+"&othersCheckA="+a.othersCheckA+"&othersCommentsA="+a.othersCommentsA+"&othersCheckB="+a.othersCheckB+"&othersCommentsB="+a.othersCommentsB+"&othersCheckC="+a.othersCheckC+"&othersCommentsC="+a.othersCommentsC+"&othersCheckD="+a.othersCheckD+"&othersCommentsD="+a.othersCommentsD+"&othersCheckE="+a.othersCheckE+"&othersCommentsE="+a.othersCommentsE+"&othersCheckF="+a.othersCheckF+"&othersCommentsF="+a.othersCommentsF+"&cid="+a.cid+"&yellowflag="+a.yellowflag+"&redflag="+a.redflag).success(function(a){h.startAlert("success","Success","Well done! You have successfully submitted a new compliance form.","md md-done"),g.path("/listCompliance")})}a.introCheckA&&a.introCheckB&&a.qualificationCheckA&&a.qualificationCheckB&&a.qualificationCheckC&&a.qualificationCheckD&&a.qualificationCheckE&&a.backgroundCheckA&&a.selectionCheckA&&a.selectionCheckB&&a.selectionCheckC&&a.selectionCheckD&&a.selectionCheckE&&a.selectionCheckF&&a.selectionCheckG&&a.costCheckA&&a.costCheckB&&a.costCheckC&&a.costCheckD&&a.costCheckE&&a.costCheckF&&a.costCheckG&&a.urgencyCheckA&&a.urgencyCheckB&&a.urgencyCheckC&&a.urgencyCheckD&&a.urgencyCheckE?(a.redflag=0,a.yellowflag=0,"no"==a.introCheckB&&(a.yellowflag=a.yellowflag+1),"no"==a.qualificationCheckC&&(a.yellowflag=a.yellowflag+1),"no"==a.qualificationCheckD&&(a.yellowflag=a.yellowflag+1),"yes"==a.selectionCheckC&&(a.redflag=a.redflag+1),"yes"==a.selectionCheckD&&(a.redflag=a.redflag+1),"yes"==a.selectionCheckE&&(a.redflag=a.redflag+1),"yes"==a.selectionCheckF&&(a.redflag=a.redflag+1),"yes"==a.selectionCheckG&&(a.redflag=a.redflag+1),"no"==a.costCheckC&&(a.redflag=a.redflag+1),"no"==a.costCheckD&&(a.redflag=a.redflag+1),"yes"==a.costCheckE&&(a.redflag=a.redflag+1),"yes"==a.costCheckG&&(a.redflag=a.redflag+1),"yes"==a.urgencyCheckA&&(a.yellowflag=a.yellowflag+1),"yes"==a.urgencyCheckB&&(a.yellowflag=a.yellowflag+1),"yes"==a.urgencyCheckC&&(a.yellowflag=a.yellowflag+1),"yes"==a.urgencyCheckE&&(a.redflag=a.redflag+1),c()):(h.startAlert("danger","Error","Please fullfill every question","md md-error"),g.path("/compliance"))}}]),app.controller("complianceDetailsCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function(a,b,c,d,e,f,g){function h(){b.get("/getComplianceDetails?qid="+a.qid).success(function(b){a.date=b[0].date,a.redflag=b[0].redflag,a.yellowflag=b[0].yellowflag,a.introCheckA=b[0].consultant_name_check,a.introCommentsA=b[0].consultant_name_comments,a.introCheckB=b[0].company_name_check,a.introCommentsB=b[0].company_name_comments,a.qualificationCheckA=b[0].age_check,a.qualificationCommentsA=b[0].age_comments,a.qualificationCheckB=b[0].citizenship_check,a.qualificationCommentsB=b[0].citizenship_comments,a.qualificationCheckC=b[0].driving_offense_check,a.qualificationCommentsC=b[0].driving_offense_comments,a.qualificationCheckD=b[0].criminal_convictions_check,a.qualificationCommentsD=b[0].criminal_convictions_comments,a.qualificationCheckE=b[0].wh_visa_check,a.qualificationCommentsE=b[0].wh_visa_comments,a.backgroundCheckA=b[0].amount_travellers_check,a.backgroundCommentsA=b[0].amount_travellers_comments,a.selectionCheckA=b[0].departure_date_check,a.selectionCommentsA=b[0].departure_date_comments,a.selectionCheckB=b[0].min_time_check,a.selectionCommentsB=b[0].min_time_comments,a.selectionCheckC=b[0].job_placement_check,a.selectionCommentsC=b[0].job_placement_comments,a.selectionCheckD=b[0].job_type_check,a.selectionCommentsD=b[0].job_type_comments,a.selectionCheckE=b[0].location_check,a.selectionCommentsE=b[0].location_comments,a.selectionCheckF=b[0].wage_check,a.selectionCommentsF=b[0].wage_comments,a.selectionCheckG=b[0].work_hour_check,a.selectionCommentsG=b[0].work_hour_comments,a.costCheckA=b[0].money_save_check,a.costCommentsA=b[0].money_save_comments,a.costCheckB=b[0].cost_estimate_check,a.costCommentsB=b[0].cost_estimate_comments,a.costCheckC=b[0].program_price_check,a.costCommentsC=b[0].program_price_comments,a.costCheckD=b[0].exclusions_check,a.costCommentsD=b[0].exclusions_comments,a.costCheckE=b[0].flight_cost_check,a.costCommentsE=b[0].flight_cost_comments,a.costCheckF=b[0].visa_cost_check,a.costCommentsF=b[0].visa_cost_comments,a.costCheckG=b[0].insurance_cost_check,a.costCommentsG=b[0].insurance_cost_comments,a.urgencyCheckA=b[0].remaining_spots_check,a.urgencyCommentsA=b[0].remaining_spots_comments,a.urgencyCheckB=b[0].closing_week_check,a.urgencyCommentsB=b[0].closing_week_comments,a.urgencyCheckC=b[0].promotion_check,a.urgencyCommentsC=b[0].promotion_comments,a.urgencyCheckD=b[0].drop_price_check,a.urgencyCommentsD=b[0].drop_price_comments,a.urgencyCheckE=b[0].deposit_refund_check,a.urgencyCommentsE=b[0].deposit_refund_comments,a.othersCheckA=b[0].payment_plan_check,a.othersCommentsA=b[0].payment_plan_comments,a.othersCheckB=b[0].cooling_period_check,a.othersCommentsB=b[0].cooling_period_comments,a.othersCheckC=b[0].working_together_check,a.othersCommentsC=b[0].working_together_comments,a.othersCheckD=b[0].tax_return_check,a.othersCommentsD=b[0].tax_return_comments,a.othersCheckE=b[0].travell_global_check,a.othersCommentsE=b[0].travell_global_comments,a.othersCheckF=b[0].inclusions_check,a.othersCommentsF=b[0].inclusions_comments,"no"==a.introCheckB&&(a.introyellowflag=!0),"no"==a.qualificationCheckC&&(a.qualificationyellowflagC=!0),"no"==a.qualificationCheckD&&(a.qualificationyellowflagD=!0),"yes"==a.selectionCheckC&&(a.selectionredflagC=!0),"yes"==a.selectionCheckD&&(a.selectionredflagD=!0),"yes"==a.selectionCheckE&&(a.selectionredflagE=!0),"yes"==a.selectionCheckF&&(a.selectionredflagF=!0),"yes"==a.selectionCheckG&&(a.selectionredflagG=!0),"no"==a.costCheckC&&(a.costredflagC=!0),"no"==a.costCheckD&&(a.costredflagD=!0),"yes"==a.costCheckE&&(a.costredflagE=!0),"yes"==a.costCheckG&&(a.costredflagG=!0),"yes"==a.urgencyCheckA&&(a.urgencyyellowflagA=!0),"yes"==a.urgencyCheckB&&(a.urgencyyellowflagB=!0),"yes"==a.urgencyCheckC&&(a.urgencyyellowflagC=!0),"yes"==a.urgencyCheckE&&(a.urgencyredflagE=!0)})}function i(){b.get("/getinfo?cid="+a.cid).success(function(b){a.firstname=b[0].first_name,a.lastname=b[0].last_name})}"superadmin"==a.staffRole||"admin"==a.staffRole||"compliance"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),a.cid=f.cid,a.qid=f.qid,h(),i()}]),app.controller("compliancelistCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function(a,b,c,d,e,f,g){function h(){b.get("/getsubmission").success(function(c){a.allDateCidflag=c,b.get("/getAllinfo").success(function(b){for(a.allNamePhoneCid=b,i=0;i<a.allDateCidflag.length;i++)for(j=0;j<a.allNamePhoneCid.length;j++)if(a.allDateCidflag[i].cid==a.allNamePhoneCid[j].cid){var c=a.allNamePhoneCid[j].prefferd_contact_no,f=a.allNamePhoneCid[j].first_name,g=a.allNamePhoneCid[j].last_name,h=a.allDateCidflag[i].cid,k=a.allDateCidflag[i].date,l=a.allDateCidflag[i].redflag,m=a.allDateCidflag[i].yellowflag,n=a.allDateCidflag[i].qid;a.myArray.push({cid:h,first_name:f,last_name:g,date:k,prefferd_contact_no:c,redflag:l,yellowflag:m,qid:n});break}a.listTable=new e({page:1,count:10},{total:a.myArray.length,getData:function(b){return a.data=b.sorting()?d("orderBy")(a.myArray,b.orderBy()):a.myArray,a.data=b.filter()?d("filter")(a.data,b.filter()):a.data,a.data=a.data.slice((b.page()-1)*b.count(),b.page()*b.count()),a.data}})})})}"superadmin"==a.staffRole||"admin"==a.staffRole||"compliance"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),a.myArray=[],h(),console.log("4",a.myArray.length),a.viewDetails=function(a){var b=a.cid,c=a.qid;g.path("/viewDetails/"+b+"/"+c)}}]),app.controller("customersCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function(a,b,c,d,e,f,g){function h(){b.get("/findCustomers").success(function(b){for(console.log(b),a.customers=b,i=0;i<b.length;i++)a.customers[i].time=b[i].time.substring(0,10);a.customersTable=new e({page:1,count:10},{total:a.customers.length,getData:function(b){return a.data=b.sorting()?d("orderBy")(a.customers,b.orderBy()):a.customers,a.data=b.filter()?d("filter")(a.data,b.filter()):a.data,a.data=a.data.slice((b.page()-1)*b.count(),b.page()*b.count()),a.data}})})}"superadmin"==a.staffRole||"admin"==a.staffRole||"finance"==a.staffRole||"sales"==a.staffRole||"coordinator"==a.staffRole||"travel"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),h(),a.viewProfile=function(a){var b=a.cid;console.log(a.cid),g.path("/viewProfile/"+b)}}]),app.controller("DashboardController",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$timeout","promiseTracker","$rootScope",function(a,b,c,d,e,f,g,h,i,j){j.greeting&&(j.startAlert("success","Success","Welcome to our customer management platform!","md md-done"),j.greeting=!1)}]),app.controller("loginCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$timeout","promiseTracker","$rootScope",function(a,b,c,d,e,f,g,h,i,j){function k(){b.get("/checkIP").success(function(a){console.log(a),"true"==a?(console.log("Welcome Staff"),l()):window.location.replace("../../views/wronglocation.html")})}function l(){var b=h(function(){a.showform=!0,a.hideform=!1,a.hideLoading=!1},3e3);a.loadingTracker.addPromise(b)}a.showform=!1,a.hideform=!0,a.hideLoading=!0,a.se=!1,a.loadingTracker=i(),k(),a.doLogin=function(){function c(){b.get("/findPassword?email="+d+"&password="+e).success(function(b){console.log(b),"true"==b?window.location.replace("../../views/main/main.html"):"wrongemail"==b?a.se=!0:a.se=!0})}var d=a.loginEmail,e=a.loginPassword;c()},a.dismiss=function(){a.se=!1}}]),app.controller("mainCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$alert","localStorageService","$timeout","$animate","todoService","$rootScope","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){b.get("/checkLogin").success(function(b){console.log(b),"true"==b[0]?(a.staffName=b[1],a.staffEmail=b[2],a.staffRole=b[3],console.log("office is ",b[4]),"admin"==b[3]?(a.bookingsShow=!0,a.paymentsShow=!0,a.complianceShow=!0,a.salesShow=!0,a.coordinationShow=!0,a.arrivalsShow=!0,a.travelShow=!0):"travel"==b[3]?(a.bookingsShow=!0,a.travelShow=!0):"coordinator"==b[3]?(a.bookingsShow=!0,a.paymentsShow=!0,a.coordinationShow=!0):"finance"==b[3]?(a.bookingsShow=!0,a.paymentsShow=!0):"compliance"==b[3]?a.complianceShow=!0:"sales"==b[3]?(a.bookingsShow=!0,a.salesShow=!0):"superadmin"==b[3]&&(a.bookingsShow=!0,a.paymentsShow=!0,a.complianceShow=!0,a.salesShow=!0,a.coordinationShow=!0,a.arrivalsShow=!0,a.travelShow=!0,a.settingsShow=!0,a.emptyShow=!0)):window.location.replace("/")})}function p(){b.get("/checkpermission").success(function(a){window.location.replace("/")})}a.theme_colors=["pink","red","purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange"],service=new l(a),a.todosCount=service.count(),a.$on("todos:count",function(b,c){a.todosCount=c,element=angular.element("#todosCount"),element.hasClass("animated")||k.addClass(element,"animated bounce",function(){k.removeClass(element,"animated bounce")})}),a.fillinContent=function(){a.htmlContent="content content"},a.changeColorTheme=function(b){m.$broadcast("theme:change","Choose template"),a.theme.color=b},a.changeTemplateTheme=function(b){m.$broadcast("theme:change","Choose color"),a.theme.template=b},i.get("theme")||(theme={color:"theme-pink",template:"theme-template-dark"},i.set("theme",theme)),i.bind(a,"theme"),o(),a.logout=function(){function a(){b.get("/logout").success(function(a){window.location.replace("/")})}a()},p();var q=h({title:"Welcome to Materialism",content:"Stay a while and listen",placement:"top-right",type:"theme",container:".alert-container-top-right",show:!1,template:"alert-introduction.html",animation:"mat-grow-top-right"});i.get("alert-introduction")||j(function(){a.showIntroduction(),i.set("alert-introduction",1)},2500),a.showIntroduction=function(){q.show(),console.log("test alert")};var r=h({title:"Hi there!",content:'You like what you see and interested in using our theme? You can find it at <a href="http://themeforest.net/item/materialism-angular-bootstrap-admin-template/11322821" target="_blank"><img style="height:20px;" src="../../assets/img/icons/themeforest-icon.png" /> Themeforest</a>.',placement:"top-right",type:"theme",container:".alert-container-top-right",show:!1,animation:"mat-grow-top-right"});(""===document.referrer||0!==document.referrer.indexOf("themeforest.net"))&&j(function(){r.show()},1750)}]),app.controller("newCustomerCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function(a,b,c,d,e,f,g){"superadmin"==a.staffRole||"admin"==a.staffRole||"finance"==a.staffRole||"coordinator"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),a.data1={availableOptions:[{id:"Working Holiday",name:"Working Holiday"},{id:"Volunteer",name:"Volunteer"},{id:"Au Pair",name:"Au Pair"},{id:"Teach",name:"Teach"},{id:"Internship",name:"Internship"}],selectedOption:{id:"Working Holiday",name:"Working Holiday"}}}]),app.controller("addPaymentCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","ngDialog","$timeout","$rootScope",function(a,b,c,d,e,f,g,h,j,k){function l(){b.get("/checkOffice").success(function(b){"canada"==b&&(a.data3.selectedOption.name="CAD",a.data3.selectedOption.id="CAD"),"uk"==b&&(a.data3.selectedOption.name="GBP",a.data3.selectedOption.id="GBP"),"australia"==b&&(a.data3.selectedOption.name="AUD",a.data3.selectedOption.id="AUD")})}function m(){b.get("/findcustomersName").success(function(b){a.customerName2="";var c=[];for(i=0;i<b.length;i++){var d=b[i].first_name+" "+b[i].last_name;c.push(d)}a.states=c})}"superadmin"==a.staffRole||"admin"==a.staffRole||"finance"==a.staffRole||"coordinator"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),a.remove=function(){console.log("alert starting");var a=angular.element(document.querySelector("#divID"));a.empty()},a.data2={availableOptions:[{id:"Paid",name:"Paid"},{id:"Next",name:"Next"},{id:"Error",name:"Error"},{id:"Refund",name:"Refund"},{id:"Discount",name:"Discount"},{id:"On Hold",name:"On Hold"}],selectedOption:{id:"Paid",name:"Paid"}},a.data3={availableOptions:[{id:"GBP",name:"GBP"},{id:"USD",name:"USD"},{id:"AUD",name:"AUD"},{id:"CAD",name:"CAD"}],selectedOption:{id:"AUD",name:"AUD"}},l(),m(),a.addpayment=function(){function c(){b.get("/getCID?customerName2="+d).success(function(c){1==c.length?(console.log("this is a test ok?????",c[0].cid),b.post("/addPayment?customerName2="+d+"&paymentStatus="+e+"&paymentAmount="+f+"&paymentDate="+g+"&currency="+h+"&cid="+c[0].cid).success(function(b){a.customerName2=null,a.paymentAmount=null,a.paymentDate=null,k.startAlert("success","Success","Well done! You successfully submit a new payment form.","md md-done")})):(console.log("another test ok?????"),a.customerName2=null,a.paymentAmount=null,a.paymentDate=null,k.startAlert("danger","Error","Well, you must type a wrong customer name","md md-error"))})}console.log("testttttt",a.selectedState);var d=a.customerName2,e=a.data2.selectedOption.name,f=a.paymentAmount,g=a.paymentDate,h=a.data3.selectedOption.name;console.log("1",g),c()},a.totalAmount=0,a.change=function(){b.get("/getpayment?customerName2="+a.customerName2).success(function(b){if(b.length>0){for(a.list=b,i=0;i<b.length;i++)a.totalAmount=a.totalAmount+b[i].paymentAmount,a.list[i].paymentAmount=Number(b[i].paymentAmount).toLocaleString("en");a.currency=b[0].Currency}else a.list={},a.totalAmount=0})}}]),app.controller("profileCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function(a,b,c,d,e,f,g){function h(){b.get("/findProfile?cid="+f.cid).success(function(c){console.log(c[0]),a.profile=c[0];var d=c[0].email;b.get("/getHubspotData?email="+d).success(function(c){function d(c){b.get("/getOwnerName?ownerID="+c).success(function(b){console.log(b),b?a.ownerName=b:a.ownerName="NA"})}if(c.hs_analytics_source?a.os=c.hs_analytics_source.value:a.os="NA",c.createdate?a.cd=c.createdate.value:a.cd="NA",c.hs_analytics_source_data_1?a.osd=c.hs_analytics_source_data_1.value:a.osd="NA",c.closedate?a.closedate=c.closedate.value:a.closedate="NA",c.hubspot_owner_id){var e=c.hubspot_owner_id.value;d(e)}else a.ownerName="NA"})})}function i(){b.get("/checkMarketingCID?cid="+f.cid).success(function(c){console.log("the lenght is: ",c.length),1==c.length?(a.button="Update Database",a.uploadHubspot=function(){function c(){b.post("/updateHubspot?cid="+a.c+"&os="+a.os+"&createdate="+a.cd+"&hsOwner="+a.ownerName+"&campName="+a.osd+"&closeDate="+a.closedate).success(function(a){console.log(a),console.log("data updated")})}a.os&&a.cd&&a.ownerName&&a.osd&&a.closedate?(console.log("test",a.ownerName),c()):console.log("data empty")}):(a.button="Insert Into Database",a.uploadHubspot=function(){function c(){b.post("/insertHubspot?cid="+a.c+"&os="+a.os+"&createdate="+a.cd+"&hsOwner="+a.ownerName+"&campName="+a.osd+"&closeDate="+a.closedate).success(function(a){console.log(a),console.log("data inserted")})}a.os&&a.cd&&a.ownerName&&a.osd&&a.closedate?(console.log("test",a.ownerName),c()):console.log("data empty")})})}"superadmin"==a.staffRole||"admin"==a.staffRole||"finance"==a.staffRole||"sales"==a.staffRole||"coordinator"==a.staffRole||"travel"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),a.c=f.cid,h(),i()}]),app.controller("searchccCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function(a,b,c,d,e,f,g){"superadmin"==a.staffRole||"admin"==a.staffRole||"finance"==a.staffRole||"sales"==a.staffRole||"coordinator"==a.staffRole||"travel"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),a.findcid=function(){function c(){b.get("/findfromcid?cid="+a.CID).success(function(b){a.cinfo=b[0],console.log(a.cinfo)})}c()}}]),app.controller("searchPaymentCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function(a,b,c,d,e,f,g,h){function i(){b.get("/findAllPayments").success(function(b){a.allpayments=b,a.data=b,a.tableParams=new e({page:1,count:10,sorting:{firstname:"asc"}},{filterDelay:50,total:b.length,getData:function(a,c){var e=c.filter().search,f=c.filter().start,g=c.filter().end;console.log("search: "+e),console.log("start: "+f),console.log("end: "+g);var h=[];e?(e=e.toLowerCase(),h=b.filter(function(a){return a.customerName.toLowerCase().indexOf(e)>-1})):h=b,f&&g?h=h.filter(function(a){return a.paymentDate>=f&&a.paymentDate<=g}):f?h=h.filter(function(a){return a.paymentDate>=f}):g&&(h=h.filter(function(a){return a.paymentDate<=g})),h=c.sorting()?d("orderBy")(h,c.orderBy()):h,a.resolve(h.slice((c.page()-1)*c.count(),c.page()*c.count()))}})})}"superadmin"==a.staffRole||"admin"==a.staffRole||"finance"==a.staffRole||"coordinator"==a.staffRole?console.log("works fine"):(console.log("no permission dude"),g.path("/")),a.reset=function(){window.location.reload()},a.overduess=!1,i(),a.checkboxCheck=function(){function c(){b.get("/findOverdues").success(function(b){a.data=b,console.log(b),a.tableParams=new e({page:1,count:10,sorting:{firstname:"asc"}},{filterDelay:50,total:b.length,getData:function(a,c){var e=c.filter().search,f=c.filter().start,g=c.filter().end;console.log("search: "+e),console.log("start: "+f),console.log("end: "+g);var h=[];e?(e=e.toLowerCase(),h=b.filter(function(a){return a.customerName.toLowerCase().indexOf(e)>-1})):h=b,f&&g?h=h.filter(function(a){return a.paymentDate>=f&&a.paymentDate<=g}):f?h=h.filter(function(a){return a.paymentDate>=f}):g&&(h=h.filter(function(a){return a.paymentDate<=g})),h=c.sorting()?d("orderBy")(h,c.orderBy()):h,a.resolve(h.slice((c.page()-1)*c.count(),c.page()*c.count()))}})})}a.overduess?(c(),console.log("overdue data")):(console.log("all data"),i())},a.update=function(a){function c(){b.get("/changePayment?paymentID="+paymentID+"&paymentAmount="+paymentAmount+"&paymentStatus="+paymentStatus).success(function(a){h.startAlert("info","Success","Well done! You have successfully updated.","md md-done")})}var d=[];d[0]=a.paymentID,d[1]=a.paymentAmount,d[2]=a.paymentStatus,paymentID=d[0],paymentAmount=d[1],paymentStatus=d[2],console.log("test array",d),c()}}]),app.controller("usersCtrl",["$scope","$window","$aside","$http","$location","$rootScope","$route",function(a,b,c,d,e,f,g){function h(){d.get("/findUsers").success(function(b){console.log(b),a.data=b})}"superadmin"==a.staffRole?console.log("hello super admin"):(console.log("you are not super admin"),e.path("/")),a.settings={singular:"User",plural:"Users",cmd:"Add"},a.roleselect={availableOptions:[{id:"admin",name:"admin"},{id:"travel",name:"travel"},{id:"coordinator",name:"coordinator"},{id:"finance",name:"finance"},{id:"compliance",name:"compliance"},{id:"superadmin",name:"superadmin"},{id:"sales",name:"sales"}],selectedOption:{id:"admin",name:"admin"}},a.officeselect={availableOptions:[{id:"australia",name:"australia"},{id:"canada",name:"canada"},{id:"uk",name:"uk"}],selectedOption:{id:"australia",name:"australia"}},h();var i=c({scope:a,template:"../setting/users-form.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-left"}),j=c({scope:a,template:"../setting/edit.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});a.checkAll=function(){angular.forEach(a.data,function(a){a.selected=!a.selected})},a.editItem=function(b){b&&(b.editing=!0,a.item=b,a.roleselect.selectedOption.name=b.role,a.roleselect.selectedOption.id=b.role,a.officeselect.selectedOption.name=b.office,a.officeselect.selectedOption.id=b.office,console.log("this item need to be edited:",b.email,b.id),a.settings.cmd="Edit",console.log(a.settings.cmd),a.editconfirm=!0,showEditForm())},a.changeP=function(b){b&&(b.editing=!0,b.hide=!0,a.item=b,a.item.password="",a.settings.cmd="changeP",showForm())},a.viewItem=function(b){b&&(b.editing=!1,b.hide=!1,a.item=b,a.roleselect.selectedOption.name=b.role,a.roleselect.selectedOption.id=b.role,a.officeselect.selectedOption.name=b.office,a.officeselect.selectedOption.id=b.office,a.settings.cmd="View",showForm())},a.createItem=function(){var b={editing:!0,hide:!1};a.item=b,a.settings.cmd="New",showForm()},a.saveItem=function(){console.log(a.settings.cmd),"New"==a.settings.cmd&&(a.item.password==a.item.repeatedpassword?d.post("/addUser?f="+a.item.first_name+"&l="+a.item.last_name+"&r="+a.roleselect.selectedOption.name+"&o="+a.officeselect.selectedOption.name+"&e="+a.item.email+"&p="+a.item.password).success(function(b){a.item.role=a.roleselect.selectedOption.name,a.item.office=a.officeselect.selectedOption.name,a.data.push(a.item),f.startAlert("success","Success","Well done! You have successfully added a new user.","md md-done"),console.log(b),hideForm()}):(f.startAlert("danger","Error","Please check the password and type again","md md-error"),hideForm())),"changeP"==a.settings.cmd&&(a.item.password==a.item.repeatedpassword?d.post("/changePassword?p="+a.item.password+"&e="+a.item.email).success(function(a){f.startAlert("success","Success","Well done! You have successfully changes the password.","md md-done"),hideForm()}):(f.startAlert("danger","Error","Please confirm your password","md md-error"),hideForm()))},a.saveEditItem=function(){console.log("for editing test"),console.log(a.settings.cmd),"Edit"==a.settings.cmd&&(console.log("time to edit"),d.post("/editUser?f="+a.item.first_name+"&l="+a.item.last_name+"&r="+a.roleselect.selectedOption.name+"&o="+a.officeselect.selectedOption.name+"&e="+a.item.email+"&id="+a.item.id).success(function(a){f.startAlert("success","Success","Well done! You have successfully edited this user info.","md md-done"),g.reload()}))},a.remove=function(b){confirm("Are you sure?")&&(b?(console.log("test here",b.email),d.post("/deleteUser?email="+b.email).success(function(c){f.startAlert("info","Success","You have just successfully deleted a user.","md md-done"),a.data.splice(a.data.indexOf(b),1)})):(console.log(b,"testha"),f.startAlert("info","Success","You have just successfully removed multiple users.","md md-done"),a.data=a.data.filter(function(a){return a.selected&&d.post("/deleteUser?email="+a.email).success(function(b){console.log(a.first_name,"deleted")}),!a.selected}),console.log("test 2 here"),a.selectAll=!1))},showForm=function(){angular.element(".tooltip").remove(),i.show()},showEditForm=function(){angular.element(".tooltip").remove(),j.show()},hideForm=function(){i.hide()},hideEditForm=function(){j.hide()},a.$on("$destroy",function(){hideForm(),hideEditForm()})}]),app.controller("wronglocationCtrl",["$scope","$http","$interval","$filter","$routeParams","$location","$timeout",function(a,b,c,d,e,f,g){}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/customer",{templateUrl:"../bookings/customer.html"}).when("/viewProfile/:cid",{templateUrl:"../bookings/profile.html"}).when("/searchcc",{templateUrl:"../bookings/searchcc.html"}).when("/newCustomer",{templateUrl:"../payment/newCustomer.html"}).when("/addPayment",{templateUrl:"../payment/addPayment.html"}).when("/searchPayment",{templateUrl:"../payment/searchPayment.html"}).when("/compliance",{templateUrl:"../compliance/compliance.html"}).when("/listCompliance",{templateUrl:"../compliance/listCompliance.html"}).when("/viewDetails/:cid/:qid",{templateUrl:"../compliance/complianceDetails.html"}).when("/users",{templateUrl:"../setting/users.html"}).when("/",{templateUrl:"../dashboard.html"}).otherwise({templateUrl:"../dashboard.html"})}]),app.config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1,a.latencyThreshold=300}]),app.config(["$animateProvider",function(a){a.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/)}]);